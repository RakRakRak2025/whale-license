<button class="admin-btn" style="background: #ffc107; color: black;" onclick="exportData()">
                   ğŸ“Š ë°ì´í„° ë‚´ë³´ë‚´ê¸°
               </button>
           </div>
       </div>
   </div>
   
   <!-- ì¿ í° ëª¨ë‹¬ -->
   <div class="coupon-modal" id="couponModal" onclick="closeCoupon(event)">
       <div class="coupon-content">
           <h2>ğŸ‰ ê³ ë˜íŒ¨ìŠ¤ í˜œíƒ ì‚¬ì „ì‹ ì²­!</h2>
           <p style="color: #666; margin: 10px 0;">ì˜¤í”ˆ ì˜ˆì • - ì‚¬ì „ ì‹ ì²­í•˜ê³  íŠ¹ë³„ í˜œíƒì„ ë°›ìœ¼ì„¸ìš”!</p>
           
           <form id="couponForm" style="margin-top: 20px; text-align: left;">
               <div style="margin-bottom: 15px;">
                   <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¦„ *</label>
                   <input type="text" id="userName" required style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
               </div>
               
               <div style="margin-bottom: 15px;">
                   <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì—°ë½ì²˜ ì„ íƒ *</label>
                   <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                       <label style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; cursor: pointer;">
                           <input type="radio" name="contactType" value="phone" checked onchange="toggleContactInput()"> ğŸ“± íœ´ëŒ€í°
                       </label>
                       <label style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; cursor: pointer;">
                           <input type="radio" name="contactType" value="kakao" onchange="toggleContactInput()"> ğŸ’¬ ì¹´ì¹´ì˜¤í†¡
                       </label>
                   </div>
                   <input type="tel" id="phoneNumber" placeholder="010-0000-0000" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                   <input type="text" id="kakaoId" placeholder="ì¹´ì¹´ì˜¤í†¡ ID" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; display: none;">
               </div>
               
               <div style="margin-bottom: 20px;">
                   <label style="display: flex; align-items: flex-start; gap: 10px; font-size: 14px; color: #666;">
                       <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                       <span>
                           ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.<br>
                           <small style="display: block; margin-top: 5px; line-height: 1.4;">
                               â€¢ ìˆ˜ì§‘í•­ëª©: ì´ë¦„, ì—°ë½ì²˜(íœ´ëŒ€í° ë˜ëŠ” ì¹´ì¹´ì˜¤í†¡ ID)<br>
                               â€¢ ìˆ˜ì§‘ëª©ì : ê³ ë˜íŒ¨ìŠ¤ ì¿ í° ë°œì†¡ ë° ì´ë²¤íŠ¸ ì•ˆë‚´<br>
                               â€¢ ë³´ìœ ê¸°ê°„: ì„œë¹„ìŠ¤ ì¢…ë£Œ í›„ 1ë…„<br>
                               â€¢ ìˆ˜ì§‘ì—…ì²´: ì†Œì…œë§ˆì¼€íŒ…ì—°êµ¬ì†Œ
                           </small>
                       </span>
                   </label>
               </div>
               
               <button type="submit" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                   ì‚¬ì „ì‹ ì²­ ì™„ë£Œí•˜ê¸°
               </button>
           </form>
           
           <div id="couponSuccess" style="display: none; text-align: center; padding: 20px;">
               <div style="font-size: 60px; margin-bottom: 20px;">âœ…</div>
               <h3>ì‚¬ì „ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
               <p style="color: #666; margin-top: 10px;">ê³ ë˜íŒ¨ìŠ¤ ì˜¤í”ˆ ì‹œ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
               <button onclick="closeCoupon()" style="margin-top: 20px; padding: 10px 30px; background: #6c757d; color: white; border: none; border-radius: 20px; cursor: pointer;">ë‹«ê¸°</button>
           </div>
       </div>
   </div>
   
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
   <script>
       let selectedAvatar = 'ğŸ‹';
       let licenseNum = generateLicenseNumber();
       let serviceEnabled = true;
       
       // í†µê³„ ë°ì´í„° ì´ˆê¸°í™”
       function initStats() {
           if (!localStorage.getItem('whaleStats')) {
               localStorage.setItem('whaleStats', JSON.stringify({
                   total: 0,
                   today: 0,
                   lastDate: new Date().toDateString(),
                   whaleTypes: {}
               }));
           }
       }
       
       // ì´ˆê¸°í™”
       window.onload = function() {
           initStats();
           updateLicense();
           generateBarcode();
           document.getElementById('issueDate').textContent = formatDate(new Date());
           document.getElementById('expiryDate').textContent = formatDate(getExpiryDate());
           document.getElementById('licenseNumber').textContent = licenseNum;
           
           // URL íŒŒë¼ë¯¸í„° ì²´í¬ (ê´€ë¦¬ì ëª¨ë“œ)
           const urlParams = new URLSearchParams(window.location.search);
           if (urlParams.get('admin') === 'true') {
               setTimeout(() => {
                   toggleAdmin();
               }, 500);
           }
           
           // í†µê³„ ì—…ë°ì´íŠ¸
           updateStats();
           
           // ì„œë¹„ìŠ¤ ìƒíƒœ ì²´í¬
           checkServiceStatus();
           
           // ë°©ë¬¸ ê¸°ë¡
           recordVisit();
       };
       
       // ë°©ë¬¸ ê¸°ë¡ í•¨ìˆ˜
       function recordVisit() {
           const visits = parseInt(localStorage.getItem('totalVisits') || '0');
           localStorage.setItem('totalVisits', visits + 1);
           
           // ì²« ë°©ë¬¸ì í™˜ì˜
           if (visits === 0) {
               setTimeout(() => {
                   alert('ğŸ‹ í™˜ì˜í•©ë‹ˆë‹¤! ìš¸ì‚° ê³ ë˜ë©´í—ˆì¦ì„ ë°œê¸‰ë°›ê³  íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”!');
               }, 1000);
           }
       }
       
       // ì„œë¹„ìŠ¤ ìƒíƒœ ì²´í¬
       function checkServiceStatus() {
           const status = localStorage.getItem('serviceStatus');
           if (status === 'stopped') {
               serviceEnabled = false;
               document.getElementById('serviceBanner').style.display = 'block';
               document.querySelector('.btn-download').disabled = true;
               document.querySelector('.btn-download').style.opacity = '0.5';
           }
       }
       
       // í†µê³„ ì—…ë°ì´íŠ¸
       function updateStats() {
           const stats = JSON.parse(localStorage.getItem('whaleStats'));
           
           // ë‚ ì§œ ì²´í¬ (ì˜¤ëŠ˜ í†µê³„ ë¦¬ì…‹)
           if (stats.lastDate !== new Date().toDateString()) {
               stats.today = 0;
               stats.lastDate = new Date().toDateString();
           }
           
           document.getElementById('todayCount').textContent = stats.today;
           document.getElementById('totalCount').textContent = stats.total;
           
           // ì¸ê¸° ê³ ë˜ ê³„ì‚°
           if (Object.keys(stats.whaleTypes).length > 0) {
               const popular = Object.entries(stats.whaleTypes)
                   .sort(([,a], [,b]) => b - a)[0];
               document.getElementById('popularWhale').textContent = popular[0];
           }
           
           localStorage.setItem('whaleStats', JSON.stringify(stats));
       }
       
       // ë°œê¸‰ ì‹œ í†µê³„ ê¸°ë¡
       function recordLicense() {
           const stats = JSON.parse(localStorage.getItem('whaleStats'));
           stats.total++;
           stats.today++;
           
           const whaleType = document.getElementById('whaleType').value;
           if (whaleType) {
               stats.whaleTypes[whaleType] = (stats.whaleTypes[whaleType] || 0) + 1;
           }
           
           localStorage.setItem('whaleStats', JSON.stringify(stats));
           updateStats();
       }
       
       // ê´€ë¦¬ì íŒ¨ë„ í† ê¸€
       function toggleAdmin() {
           const panel = document.getElementById('adminPanel');
           const isOpen = panel.style.display === 'block';
           
           if (!isOpen) {
               const password = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
               if (password !== '1633') {
                   alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                   return;
               }
           }
           
           panel.style.display = isOpen ? 'none' : 'block';
           updateStats();
       }
       
       // ì„œë¹„ìŠ¤ í† ê¸€
       function toggleService() {
           serviceEnabled = !serviceEnabled;
           localStorage.setItem('serviceStatus', serviceEnabled ? 'active' : 'stopped');
           
           const banner = document.getElementById('serviceBanner');
           banner.style.display = serviceEnabled ? 'none' : 'block';
           
           const btn = document.getElementById('serviceToggle');
           btn.textContent = serviceEnabled ? 'ğŸš« ë°œê¸‰ ì¤‘ì§€' : 'âœ… ë°œê¸‰ ì¬ê°œ';
           
           alert(serviceEnabled ? 'ì„œë¹„ìŠ¤ê°€ ì¬ê°œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì„œë¹„ìŠ¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
       }
       
       // ì¤‘ì§€ ì˜ˆì•½
       function scheduleStop() {
           const time = prompt('ëª‡ ì‹œê°„ í›„ì— ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìˆ«ìë§Œ ì…ë ¥)');
           if (time) {
               alert(`${time}ì‹œê°„ í›„ì— ì„œë¹„ìŠ¤ê°€ ì¤‘ì§€ë©ë‹ˆë‹¤.`);
               setTimeout(() => {
                   toggleService();
               }, time * 3600000);
           }
       }
       
       // í†µê³„ ì´ˆê¸°í™”
       function resetStats() {
           if (confirm('ì •ë§ë¡œ ëª¨ë“  í†µê³„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
               localStorage.setItem('whaleStats', JSON.stringify({
                   total: 0,
                   today: 0,
                   lastDate: new Date().toDateString(),
                   whaleTypes: {}
               }));
               updateStats();
               alert('í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
           }
       }
       
       // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
       function exportData() {
           const stats = JSON.parse(localStorage.getItem('whaleStats'));
           const applications = JSON.parse(localStorage.getItem('couponApplications') || '[]');
           
           const data = `ìš¸ì‚° ê³ ë˜ë©´í—ˆì¦ í†µê³„ ë¦¬í¬íŠ¸
ìƒì„±ì¼: ${new Date().toLocaleString()}

[ë°œê¸‰ í˜„í™©]
- ì „ì²´ ë°œê¸‰: ${stats.total}ê±´
- ì˜¤ëŠ˜ ë°œê¸‰: ${stats.today}ê±´
- ì¿ í° ì‹ ì²­: ${stats.couponApplications || 0}ê±´

[ê³ ë˜ë³„ í†µê³„]
${Object.entries(stats.whaleTypes || {}).map(([type, count]) => 
   `- ${type}: ${count}ê±´`).join('\n')}

[ì¿ í° ì‚¬ì „ì‹ ì²­ ëª©ë¡]
${applications.map((app, idx) => 
   `${idx + 1}. ${app.name} / ${app.contactType === 'phone' ? 'ğŸ“±' : 'ğŸ’¬'} ${app.contact} / ${new Date(app.timestamp).toLocaleString()}`
).join('\n')}

[ì„œë¹„ìŠ¤ ìƒíƒœ]
- í˜„ì¬: ${serviceEnabled ? 'ì •ìƒ ìš´ì˜' : 'ì¼ì‹œ ì¤‘ì§€'}
`;
           
           const blob = new Blob([data], { type: 'text/plain' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = `ê³ ë˜ë©´í—ˆì¦_í†µê³„_${new Date().toLocaleDateString()}.txt`;
           a.click();
       }
       
       // ì¿ í° í‘œì‹œ
       function showCoupon() {
           document.getElementById('couponModal').style.display = 'flex';
           document.getElementById('couponForm').style.display = 'block';
           document.getElementById('couponSuccess').style.display = 'none';
           document.getElementById('couponForm').reset();
       }
       
       // ì¿ í° ë‹«ê¸°
       function closeCoupon(event) {
           if (!event || event.target === document.getElementById('couponModal')) {
               document.getElementById('couponModal').style.display = 'none';
           }
       }
       
       // ì—°ë½ì²˜ ì…ë ¥ í† ê¸€
       function toggleContactInput() {
           const contactType = document.querySelector('input[name="contactType"]:checked').value;
           document.getElementById('phoneNumber').style.display = contactType === 'phone' ? 'block' : 'none';
           document.getElementById('kakaoId').style.display = contactType === 'kakao' ? 'block' : 'none';
       }
       
       // ì¿ í° í¼ ì œì¶œ
       document.getElementById('couponForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           if (!document.getElementById('agreeTerms').checked) {
               alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
               return;
           }
           
           // ë°ì´í„° ìˆ˜ì§‘
           const contactType = document.querySelector('input[name="contactType"]:checked').value;
           const formData = {
               name: document.getElementById('userName').value,
               contactType: contactType,
               contact: contactType === 'phone' 
                   ? document.getElementById('phoneNumber').value 
                   : document.getElementById('kakaoId').value,
               timestamp: new Date().toISOString(),
               whaleType: document.getElementById('whaleType').value || 'ë¯¸ì„ íƒ',
               purpose: document.getElementById('experience').value || 'ë¯¸ì„ íƒ'
           };
           
           // ë¡œì»¬ ì €ì¥
           let applications = JSON.parse(localStorage.getItem('couponApplications') || '[]');
           applications.push(formData);
           localStorage.setItem('couponApplications', JSON.stringify(applications));
           
           // ì„±ê³µ í™”ë©´ í‘œì‹œ
           document.getElementById('couponForm').style.display = 'none';
           document.getElementById('couponSuccess').style.display = 'block';
           
           // í†µê³„ ì—…ë°ì´íŠ¸
           const stats = JSON.parse(localStorage.getItem('whaleStats'));
           stats.couponApplications = (stats.couponApplications || 0) + 1;
           localStorage.setItem('whaleStats', JSON.stringify(stats));
       });
       
       // SNS ê³µìœ 
       function shareToSNS() {
           const text = 'ë‚˜ë„ ìš¸ì‚° ê³ ë˜ë©´í—ˆì¦ ë°œê¸‰ë°›ì•˜ë‹¤! ğŸ‹\në‚˜ì˜ ê³ ë˜: ' + selectedAvatar;
           const url = window.location.href.split('?')[0];
           
           const shareOptions = `ê³µìœ í•  í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”:
1. ì¹´ì¹´ì˜¤í†¡ (ëª¨ë°”ì¼)
2. í˜ì´ìŠ¤ë¶
3. íŠ¸ìœ„í„°
4. ë§í¬ ë³µì‚¬
5. QRì½”ë“œ ìƒì„±`;
           
           const choice = prompt(shareOptions);
           
           switch(choice) {
               case '1':
                   if (/mobile/i.test(navigator.userAgent)) {
                       window.location.href = `kakaolink://send?text=${encodeURIComponent(text + '\n' + url)}`;
                   } else {
                       alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ ëŠ” ëª¨ë°”ì¼ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                   }
                   break;
               case '2':
                   window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
                   break;
               case '3':
                   window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`);
                   break;
               case '4':
                   navigator.clipboard.writeText(url).then(() => {
                       alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹\n\n' + url);
                   });
                   break;
               case '5':
                   window.open(`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(url)}`);
                   break;
           }
       }
       
       // ì•„ë°”íƒ€ ì„ íƒ
       function selectAvatar(avatar, element) {
           selectedAvatar = avatar;
           
           document.querySelectorAll('.avatar-option').forEach(opt => {
               opt.classList.remove('selected');
           });
           
           element.classList.add('selected');
           updateLicense();
       }
       
       // ì‹¤ì‹œê°„ ë©´í—ˆì¦ ì—…ë°ì´íŠ¸
       function updateLicense() {
           const name = document.getElementById('name').value || '-';
           document.getElementById('displayName').textContent = name;
           
           const birthdate = document.getElementById('birthdate').value;
           document.getElementById('displayBirth').textContent = birthdate ? formatDate(birthdate) : '-';
           
           const whaleType = document.getElementById('whaleType').value || '-';
           document.getElementById('displayWhale').textContent = whaleType;
           
           const experience = document.getElementById('experience').value || '-';
           document.getElementById('displayGrade').textContent = experience.split(' ')[0];
           
           document.getElementById('avatarDisplay').textContent = selectedAvatar;
       }
       
       // ë©´í—ˆì¦ ë²ˆí˜¸ ìƒì„±
       function generateLicenseNumber() {
           const year = new Date().getFullYear();
           const random = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
           return `UW-${year}-${random}`;
       }
       
       // ë‚ ì§œ í¬ë§·
       function formatDate(date) {
           const d = new Date(date);
           const year = d.getFullYear();
           const month = String(d.getMonth() + 1).padStart(2, '0');
           const day = String(d.getDate()).padStart(2, '0');
           return `${year}.${month}.${day}`;
       }
       
       // ìœ íš¨ê¸°ê°„ (5ë…„ í›„)
       function getExpiryDate() {
           const today = new Date();
           return new Date(today.getFullYear() + 5, today.getMonth(), today.getDate());
       }
       
       // ë°”ì½”ë“œ ìƒì„±
       function generateBarcode() {
           const barcode = document.getElementById('barcode');
           barcode.innerHTML = '';
           
           for (let i = 0; i < 25; i++) {
               const line = document.createElement('div');
               line.className = 'barcode-line';
               line.style.height = (Math.random() * 20 + 20) + 'px';
               barcode.appendChild(line);
           }
       }
       
       // ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
       function downloadLicense() {
           if (!serviceEnabled) {
               alert('í˜„ì¬ ì„œë¹„ìŠ¤ê°€ ì¤‘ì§€ë˜ì–´ ë°œê¸‰ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.');
               return;
           }
           
           recordLicense();
           
           const licenseCard = document.querySelector('.license-card');
           
           html2canvas(licenseCard, {
               backgroundColor: '#ffffff',
               scale: 2,
               logging: false,
               useCORS: true
           }).then(canvas => {
               canvas.toBlob(blob => {
                   const url = URL.createObjectURL(blob);
                   const a = document.createElement('a');
                   a.href = url;
                   a.download = `ìš¸ì‚°ê³ ë˜ë©´í—ˆì¦_${document.getElementById('displayName').textContent}_${licenseNum}.png`;
                   a.click();
                   URL.revokeObjectURL(url);
                   
                   alert('ğŸ‹ ê³ ë˜ë©´í—ˆì¦ì´ ì´ë¯¸ì§€ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ê°¤ëŸ¬ë¦¬ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
               }, 'image/png');
           }).catch(err => {
               console.error('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜:', err);
               downloadAsText();
           });
       }
       
       // í…ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ (ëŒ€ì²´ ë°©ë²•)
       function downloadAsText() {
           const licenseData = {
               ì´ë¦„: document.getElementById('displayName').textContent,
               ìƒë…„ì›”ì¼: document.getElementById('displayBirth').textContent,
               ê³ ë˜ì¢…ë¥˜: document.getElementById('displayWhale').textContent,
               ìš´ì „ëª©ì : document.getElementById('displayGrade').textContent,
               ë°œê¸‰ì¼: document.getElementById('issueDate').textContent,
               ìœ íš¨ê¸°ê°„: document.getElementById('expiryDate').textContent,
               ë©´í—ˆë²ˆí˜¸: document.getElementById('licenseNumber').textContent,
               í”„ë¡œí•„: selectedAvatar
           };
           
           let content = 'ğŸ‹ ìš¸ì‚° ê³ ë˜ë©´í—ˆì¦ ğŸ‹\n\n';
           for (const [key, value] of Object.entries(licenseData)) {
               content += `${key}: ${value}\n`;
           }
           content += '\nì£¼ì˜: ì´ ë©´í—ˆì¦ìœ¼ë¡œ ì‹¤ì œ ê³ ë˜ë¥¼ ìš´ì „í•˜ë©´ ê³¤ë€í•©ë‹ˆë‹¤! ğŸ˜„';
           
           const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
           const url = URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = `ê³ ë˜ë©´í—ˆì¦_${licenseData.ì´ë¦„}_${licenseData.ë©´í—ˆë²ˆí˜¸}.txt`;
           a.click();
           URL.revokeObjectURL(url);
       }
   </script>
</body>
</html>
